[toc]
##  <font color=#0099ff>zabbix基础</font>
### <font color=#0099ff>1. 什么是zabbix</font>
zabbix是一个分布式开元的监控系统，支持多种采集方式（如：主动模式、被动模式、代理模式、无agent模式（脚本实现）），使它几乎可以采集和处理所有类型的监控数据；灵活的报警机制，可以实现各种的自定义报警策略，（如：邮件、短信、微信、其他一些可调用api的软件），强大的拓展性，可以自定义监控项、图形、模板，还支持自动注册和自动发现，使它可以快速构建一套大型的监控系统，还有丰富的api接口。
><font color=red >**选zabbix的理由：简单！高效！灵活！**</font>
###<font color=#0099ff>2. 常见的监控系统架构</font>
数据采集-->数据存储-->数据分析、展示、告警
1. zabbix-agent完成数据采集，主动模式下，zabbix-agent会将采集到的数据发送到server端，被动模式下，zabbix-server会去agent端获取数据。
2. zabbix-server将收集到的数据存储到数据库中进行分析（需要连接数据库）。
3. zabbix-web前端将分析后的数据进行展示（需要连接数据库）。
###<font color=#0099ff>3. 安装zabbix</font>
####<font color=#0099ff>3.1 时间同步</font>
防止服务器时间不一致，发送报警信息的时候有问题。
```shell
echo -e '###Synchronization time\n*/30 * * * * /usr/sbin/ntpdate ntp1.aliyun.com' >/dev/null 2>&1 >/var/spool/cron/root
```
####<font color=#0099ff>3.2  安装zabbix</font>
#####<font color=#0099ff>3.2.1 安装zabbix及相关软件</font>
```shell
rpm -ivh http://mirrors.aliyun.com/zabbix/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm
yum install zabbix-server-mysql zabbix-web-mysql -y  #自动安装PHP、Apache 公司内不用不需要太大并发，无需安装Nginx，使用Apache足够
```
#####<font color=#0099ff>3.2.2 安装MySQL5.7</font>
```shell
wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm # 默认没有MySQL的repo源，需要下载MySQL的repo源
rpm -ivh  mysql-community-release-el7-5.noarch.rpm  #安装MySQL的repo源
ll /etc/yum.repos.d/mysql-community*   #安装好后会得到两个MySQL的相关repo源,我安装的时候有个坑需要修改源的配置文件，默认启用的是MySQL5.6的安装链接，改为7的即可
-rw-r--r-- 1 root root 1209 Jan 29  2014 /etc/yum.repos.d/mysql-community.repo
-rw-r--r-- 1 root root 1060 Jan 29  2014 /etc/yum.repos.d/mysql-community-source.repo
yum install mysql-community-server -y  #安装MySQL
```
><font color=red>**注意：MySQL5.7安装完成后会生成默认的密码，需要修改后才能正常登陆使用。不知道什么原因本人这次安装的MySQL没有生成默认密码，只能使用跳过密码验证修改密码。在my.cnf[mysqld]中添加skip-grant-tables，重启MySQL服务。重新设置密码即可。特别提醒注意的一点是，新版的mysql数据库下的user表中已经没有Password字段了,而是将加密后的用户密码存储于authentication_string字段。**</font>
```shell
mysql> update mysql.user set authentication_string=password('12QWaszx!@') where user='root' and Host = 'localhost';
mysql> flush privileges;
```
> <font color=red>**但是设置好密码后，不管运行什么命令都会提示ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement。查找相关资料解决。**</font>

**解决方法：**
1. SET PASSWORD = PASSWORD('your new password');
2. ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER;
3.  flush privileges;


#####<font color=#0099ff>3.2.3 创建zabbix数据库</font>
```shell
mysql -uroot -p
mysql> create database zabbix character set utf8 collate utf8_bin;
mysql> grant all privileges on zabbix.* to zabbix@'localhost' identified by 'zabbix@12QW';
mysql> flush privileges;
```
#####<font color=#0099ff>3.2.4 导入zabbix数据
```shell
rpm -qa zabbix-server-mysql  #查看是否安装此包
rpm -ql zabbix-server-mysql   #查看此包都安装了哪些文件
zcat /usr/share/doc/zabbix-server-mysql-3.2.8/create.sql.gz |mysql -uzabbix -pzabbix@12QW zabbix #导入数据
mysql -uzabbix -p   #查看数据是否导入成功
mysql> show databases;
mysql> use zabbix;
mysql> show tables;
```
####<font color=#0099ff>3.3 配置web页面
```shell
vim /etc/httpd/conf/httpd.conf +95 #修改Apache监听ip
ServerName 0.0.0.0:80
systemctl start httpd  #启动服务
vim /etc/zabbix/web/zabbix.conf.php #修改Apache-zabbix配置文件，将时区改为亚洲上海
php_value date.timezone Asia/Shanghai 
默认登陆账号为：Admin 密码为：zabbix
``` 
####<font color=#0099ff>3.4 配置zabbix_server</font>
```shell
服务端配置文件基本没有什么大的修改，主要修改数据库相关配置。
vim /etc/zabbix/zabbix_server.conf 
DBPassword=   #将此行注释打开，填写自己zabbix数据库的密码
```
####<font color=#0099ff>3.5 配置zabbix_agent</font>
```shell
vim /etc/zabbix/zabbix_agentd.conf
主要修改一下两处为zabbix_server服务器地址
Server=
ServerActive=127.0.0.1
```
